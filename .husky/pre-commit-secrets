#!/bin/sh
# Pre-commit hook to detect secrets

# Check for potential secrets in staged files
if git diff --cached --name-only | grep -q "\.env$"; then
  echo "❌ ERROR: Attempting to commit .env file!"
  echo "   .env files should never be committed to version control"
  echo "   Use .env.example for templates instead"
  exit 1
fi

# Check for potential API keys and tokens in staged changes
if git diff --cached | grep -E "(ANTHROPIC_API_KEY|SUPABASE_KEY|GITHUB_PERSONAL_ACCESS_TOKEN|VERCEL_TOKEN|UPSTASH.*TOKEN)=(?!your-|<|\"your)" | grep -v ".env.example"; then
  echo "⚠️  WARNING: Potential secrets detected in staged changes!"
  echo "   Please review your changes carefully"
  echo ""
  git diff --cached | grep -E "(API_KEY|TOKEN|SECRET|PASSWORD)=" | grep -v ".env.example" | head -n 5
  echo ""
  echo "   If these are real credentials, do NOT commit them!"
  exit 1
fi

exit 0
